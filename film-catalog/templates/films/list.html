{% extends 'base.html' %}

{% block title %}
  All Films list
{% endblock %}

{% block style_link %}
  <link rel="stylesheet" href="{{ url_for('static', path='/css/films/list.css') }}">
{% endblock %}

{% block main %}
  <h1 class="title text-center my-4">Films</h1>
  {% if request.session.get("message") %}
  	<div class="alert alert-dark" role="alert">
      {{ request.session.pop("message") }}
    </div>
  {% endif %}
  {% if films %}

    <label for="inputSearch" class="form-label search-label fs-3">
      Search Films
      <span class="htmx-indicator ms-2">
    <img
      src="{{ url_for('static', path='images/loading.svg') }}"
      alt="Loading..."
      width="20"
    />
      </span>
    </label>

    <input
      class="form-control"
      type="search"
      name="query"
      hx-post="{{ url_for('films:search') }}"
      hx-trigger="input changed delay:500ms, keyup[key=='Enter']"
      hx-target="#search-results"
      hx-indicator=".htmx-indicator"
      id="inputSearch"
      placeholder="Type to search film"
    >

    <div class="table-responsive mt-5">
      <table class="table table-dark table-striped-columns table-hover align-middle rounded-table">
        <thead>
        <tr>
          <th scope="col" class="text-center">slug</th>
          <th scope="col" class="text-center">title</th>
          <th scope="col" class="text-center">description</th>
          <th scope="col" class="text-center">year</th>
          <th scope="col" class="text-center">duration_minutes</th>
          <th scope="col" class="text-center">Action</th>
        </tr>
        </thead>

        <tbody class="table-group-divider" id="search-results">
        {% include 'films/components/films_table.html' %}
        </tbody>

      </table>
    </div>

    <div class="d-grid gap-2 col-6 mx-auto my-4">
      <a href="{{ url_for('films:create_view') }}" class="btn btn-primary create-film-btn">
        Create a new Film
      </a>
    </div>

  {% else %}
    <h2>No films yet</h2>
    <h3>
      But you can
      <a
        href="{{ url_for('films:create_view') }}"
        class="create_first_film_link"
      >create a new one
      </a>
    </h3>
  {% endif %}

  <script>
      document.body.addEventListener('htmx:afterRequest', function (evt) {
          if (evt.detail.elt.classList.contains('btn-danger')) {
              const modal = bootstrap.Modal.getInstance(evt.detail.elt.closest('.modal'));
              if (modal) {
                  modal.hide();
              }
          }
      });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js"
          integrity="sha384-ZBXiYtYQ6hJ2Y0ZNoYuI+Nq5MqWBr+chMrS/RkXpNzQCApHEhOt2aY8EJgqwHLkJ"
          crossorigin="anonymous"></script>


{% endblock %}
